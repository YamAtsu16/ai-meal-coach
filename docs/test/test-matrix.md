# AI食事コーチ テスト項目表

## 概要
このドキュメントは、AI食事コーチアプリケーションの全テストケースを体系的に整理したテスト項目表です。各テストファイルの詳細なテスト項目を分類・整理しています。

## テスト構成
- **総テストファイル数**: 35個
- **テストカテゴリ**: 7個
- **主要テスト対象**: フロントエンド、API、コンポーネント、ユーティリティ、認証、ミドルウェア

---

## 1. ページコンポーネントテスト

### 1.1 ランディングページ (`app/page.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 認証チェック中ローディング表示 | 認証確認中はスピナーが表示される | ローディングスピナーの表示確認 |
| 認証済みリダイレクト | 認証済みユーザーはホームページにリダイレクト | `/home`へのリダイレクト確認 |
| 未認証時ランディング表示 | 未認証時はランディングページが表示される | ページコンテンツの表示確認 |
| UI要素レンダリング | ランディングページの全UI要素が正しく表示される | ヘッダー、機能紹介、CTAボタンの表示 |
| 認証APIエラーハンドリング | 認証API失敗時の適切なエラー処理 | エラーハンドラーの呼び出し確認 |

### 1.2 ホームページ (`app/home/page.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| ページレンダリング | ホームページが正しく表示される | 基本UI要素の表示確認 |
| ダッシュボード表示 | ダッシュボードコンポーネントが表示される | チャート・統計情報の表示 |

### 1.3 ログインページ (`app/login/page.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| フォーム表示 | ログインフォームが正しく表示される | メール・パスワード入力欄 |
| バリデーション | 入力値のバリデーション機能 | 必須項目・形式チェック |
| ログイン処理 | ログイン機能の動作確認 | 認証処理・リダイレクト |

### 1.4 新規登録ページ (`app/register/page.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 登録フォーム表示 | 新規登録フォームが正しく表示される | 全入力項目の表示確認 |
| バリデーション | 登録情報のバリデーション | パスワード強度・メール形式 |
| 登録処理 | ユーザー登録機能の動作確認 | アカウント作成・自動ログイン |

### 1.5 食事記録ページ (`app/meals/new/page.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 記録フォーム表示 | 食事記録フォームが正しく表示される | 日付・食事タイプ・食品選択 |
| 食品検索機能 | 食品検索・選択機能の動作確認 | 検索結果・選択処理 |

### 1.6 食事記録編集ページ (`app/meals/[id]/edit/page.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 編集フォーム表示 | 既存データを含む編集フォーム表示 | 初期値設定・フォーム表示 |
| 更新処理 | 食事記録の更新機能 | データ更新・保存処理 |

### 1.7 栄養分析ページ (`app/analysis/page.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| ページレンダリング | 分析ページが正しく表示される | ヘッダー・日付選択・分析結果 |
| 日付選択機能 | 分析対象日付の選択機能 | 日付入力・パラメータ取得 |
| URLパラメータ処理 | URLから日付パラメータを取得 | クエリパラメータの処理 |

### 1.8 プロフィールページ (`app/profile/page.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| プロフィール表示 | ユーザープロフィール情報の表示 | 基本情報・目標設定の表示 |
| プロフィール編集 | プロフィール情報の編集機能 | 更新フォーム・保存処理 |

### 1.9 レイアウト (`app/layout.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 基本レイアウト表示 | アプリケーション全体のレイアウト | ナビゲーション・フッター・メインコンテンツ |
| プロバイダー設定 | 認証・トーストプロバイダーの設定 | コンテキスト提供の確認 |

---

## 2. APIルートテスト

### 2.1 認証API (`app/api/auth/`)

#### 2.1.1 NextAuth設定 (`[...nextauth]/route.test.js`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 基本設定確認 | NextAuth設定の正確性 | アダプター・セッション・ページ設定 |
| プロバイダー設定 | 認証プロバイダーの設定確認 | Credentials プロバイダー設定 |
| 認証処理 | 有効な認証情報での認証成功 | ユーザー認証・トークン生成 |
| 認証情報不足エラー | 不完全な認証情報のエラー処理 | バリデーションエラー |
| ユーザー未存在エラー | 存在しないユーザーのエラー処理 | 認証失敗処理 |
| パスワード不一致エラー | 間違ったパスワードのエラー処理 | 認証失敗処理 |
| JWTコールバック | JWTトークンへのユーザーID追加 | トークン生成処理 |
| セッションコールバック | セッションへのユーザーID追加 | セッション管理 |

#### 2.1.2 認証チェックAPI (`check/route.test.js`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 認証状態確認 | 現在の認証状態の取得 | トークン確認・レスポンス |
| 未認証状態処理 | 未認証時の適切なレスポンス | 401エラー・メッセージ |

#### 2.1.3 ユーザー登録API (`register/route.test.js`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 新規ユーザー登録 | ユーザーアカウントの作成 | データ保存・パスワードハッシュ化 |
| 重複メール処理 | 既存メールアドレスでの登録エラー | 重複チェック・エラーレスポンス |
| バリデーションエラー | 不正な入力データのエラー処理 | 入力値検証・エラーメッセージ |

### 2.2 食事記録API (`app/api/meals/`)

#### 2.2.1 食事記録CRUD (`route.test.js`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 食事記録取得 | 認証済みユーザーの食事記録取得 | データ取得・ソート・フィルタ |
| 未認証アクセス拒否 | 未認証での食事記録アクセス拒否 | 401エラー・認証チェック |
| データベースエラー処理 | DB接続エラー時の適切な処理 | 500エラー・エラーメッセージ |
| 新規食事記録作成 | 食事記録の新規作成 | データ保存・レスポンス確認 |
| 食事記録更新 | 既存食事記録の更新 | データ更新・バージョン管理 |
| 存在しない記録の更新 | 不正なIDでの更新エラー処理 | 404エラー・エラーハンドリング |

#### 2.2.2 個別食事記録API (`[id]/route.test.js`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 特定記録取得 | IDによる特定食事記録の取得 | 個別データ取得・権限確認 |
| 記録削除 | 食事記録の削除処理 | データ削除・権限確認 |
| 存在しない記録処理 | 不正なIDでのアクセスエラー | 404エラー・エラーメッセージ |

### 2.3 食品検索API (`app/api/food/search/route.test.js`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 食品検索機能 | キーワードによる食品検索 | 検索結果・栄養情報取得 |
| 検索結果なし | 該当なしの場合の処理 | 空配列・適切なメッセージ |
| 検索パラメータ不正 | 不正な検索クエリの処理 | バリデーションエラー |

### 2.4 栄養分析API (`app/api/analysis/route.test.js`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 食事分析実行 | 指定日の食事記録分析 | AI分析・結果生成 |
| 日付未指定エラー | 分析対象日付未指定時のエラー | 400エラー・バリデーション |
| APIキー未設定エラー | OpenAI APIキー未設定時のエラー | 500エラー・設定確認 |
| 未認証アクセス拒否 | 未認証での分析アクセス拒否 | 401エラー・認証確認 |
| 食事記録取得失敗 | 食事データ取得失敗時の処理 | 500エラー・エラーハンドリング |
| 記録なしエラー | 分析対象期間に記録なしの場合 | 404エラー・メッセージ |
| 分析処理エラー | AI分析処理中のエラー処理 | 500エラー・例外処理 |

### 2.5 プロフィールAPI (`app/api/profile/route.test.js`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| プロフィール取得 | ユーザープロフィール情報取得 | データ取得・権限確認 |
| プロフィール更新 | プロフィール情報の更新 | データ更新・バリデーション |
| 未認証アクセス拒否 | 未認証でのプロフィールアクセス拒否 | 401エラー・認証確認 |

---

## 3. UIコンポーネントテスト

### 3.1 共通レイアウトコンポーネント

#### 3.1.1 ナビゲーション (`components/common/layout/Navigation.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| ロゴ表示 | アプリケーションロゴの表示 | ロゴテキスト・リンク |
| 未認証メニュー | 未認証時のメニュー表示 | ログイン・新規登録リンク |
| 認証済みメニュー | 認証済み時のメニュー表示 | ホーム・記録・分析・プロフィール |
| アクティブリンク強調 | 現在ページのリンク強調表示 | CSSクラス・視覚的フィードバック |
| ログアウト機能 | ログアウトボタンの動作確認 | signOut関数呼び出し |
| ハンバーガーメニュー | モバイル用メニューの開閉 | メニュー表示・非表示切替 |
| モバイルメニュークリック | モバイルメニュー項目クリック時の動作 | メニュー自動クローズ |

#### 3.1.2 フッター (`components/common/layout/Footer.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| フッター表示 | フッター情報の正しい表示 | 著作権・リンク情報 |
| レスポンシブ対応 | 画面サイズに応じた表示調整 | モバイル・デスクトップ表示 |

#### 3.1.3 ページネーション (`components/common/layout/Pagination.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| ページネーション表示 | ページ番号・ナビゲーションボタン表示 | 前後ページ・番号ボタン |
| ページ切替機能 | ページ切替時の動作確認 | コールバック関数呼び出し |
| 境界値処理 | 最初・最後ページでの表示制御 | ボタン無効化・表示調整 |

### 3.2 共通UIコンポーネント

#### 3.2.1 トースト (`components/common/ui/Toast.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| トースト表示 | 通知メッセージの表示 | メッセージ・タイプ別表示 |
| 自動非表示 | 指定時間後の自動非表示 | タイマー機能・フェードアウト |
| 手動クローズ | クローズボタンによる手動非表示 | ユーザー操作・即座非表示 |

### 3.3 食事記録関連コンポーネント

#### 3.3.1 食事記録フォーム (`components/features/meal/MealRecordForm.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| フォーム初期表示 | 食事記録フォームの初期状態 | 日付・食事タイプ・食品検索欄 |
| 食品追加機能 | 食品検索・選択・追加機能 | 食品選択・リスト追加 |
| 数量変更機能 | 食品数量変更時の栄養価更新 | 計算機能・リアルタイム更新 |
| 食品削除機能 | 選択済み食品の削除機能 | 削除ボタン・リスト更新 |
| フォーム送信 | 食事記録の保存処理 | API呼び出し・成功メッセージ |
| API失敗処理 | 保存失敗時のエラー処理 | エラーメッセージ表示 |
| 編集モード | 既存データの編集機能 | 初期値設定・更新処理 |

#### 3.3.2 食品検索 (`components/features/meal/FoodSearch.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 検索フォーム表示 | 食品検索フォームの表示 | 検索入力欄・検索ボタン |
| 検索クエリ入力 | 検索キーワードの入力機能 | テキスト入力・状態管理 |
| 検索ボタンクリック | 検索ボタンによる検索実行 | API呼び出し・パラメータ送信 |
| Enterキー検索 | Enterキーによる検索実行 | キーボードイベント処理 |
| 検索結果表示 | 検索結果の一覧表示 | 食品名・栄養情報表示 |
| 食品選択機能 | 検索結果からの食品選択 | クリックイベント・コールバック |
| APIエラー処理 | 検索API失敗時のエラー処理 | エラーメッセージ・エラーハンドリング |
| 検索結果なし処理 | 検索結果が空の場合の処理 | メッセージ表示・ユーザー通知 |

#### 3.3.3 食事記録リスト (`components/features/meal/MealRecordList.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 記録リスト表示 | 食事記録の一覧表示 | 日付・食事タイプ・栄養情報 |
| 編集リンク | 各記録の編集ページリンク | 編集ページナビゲーション |
| 削除機能 | 食事記録の削除機能 | 削除確認・API呼び出し |

#### 3.3.4 食事履歴 (`components/features/meal/MealHistory.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 履歴表示 | 食事履歴の時系列表示 | 日付順・食事タイプ別表示 |
| フィルタ機能 | 期間・食事タイプでのフィルタ | 絞り込み・表示更新 |

#### 3.3.5 栄養バランスチャート (`components/features/meal/NutritionBalanceChart.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| チャート表示 | 栄養バランスのグラフ表示 | PFCバランス・視覚化 |
| データ更新 | 食事データ変更時のチャート更新 | リアルタイム更新・再描画 |

#### 3.3.6 ダッシュボードチャート (`components/features/meal/DashboardCharts.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 統計チャート表示 | ダッシュボードの各種チャート表示 | カロリー・栄養素の統計表示 |
| 期間選択機能 | 表示期間の選択・変更機能 | 日別・週別・月別表示 |

#### 3.3.7 目標比較チャート (`components/features/meal/GoalComparisonCharts.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 目標vs実績表示 | 設定目標と実際の摂取量比較 | 目標達成率・差分表示 |
| 進捗視覚化 | 目標達成の進捗視覚化 | プログレスバー・パーセンテージ |

### 3.4 分析関連コンポーネント

#### 3.4.1 栄養アドバイス (`components/features/analysis/NutritionAdvice.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| アドバイス表示 | AI生成の栄養アドバイス表示 | アドバイス内容・HTML表示 |
| ローディング状態 | 分析中のローディング表示 | スピナー・ローディングメッセージ |
| エラー状態 | 分析失敗時のエラー表示 | エラーメッセージ・再試行ボタン |

---

## 4. カスタムフックテスト

### 4.1 エラーハンドラー (`hooks/useErrorHandler.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| エラーメッセージ設定 | エラーメッセージの状態管理 | エラー状態・トースト表示 |
| Error型エラー処理 | Error オブジェクトの処理 | エラーメッセージ抽出・表示 |
| 未知エラー型処理 | 予期しないエラー型の処理 | デフォルトメッセージ表示 |
| カスタムメッセージ | カスタムエラーメッセージの設定 | メッセージ上書き・表示 |
| エラークリア | エラー状態のクリア機能 | 状態リセット・UI更新 |
| JSONレスポンス抽出 | APIレスポンスからのエラー抽出 | JSON解析・メッセージ取得 |
| テキストレスポンス抽出 | プレーンテキストエラーの抽出 | テキスト解析・メッセージ取得 |

---

## 5. プロバイダーテスト

### 5.1 認証プロバイダー (`providers/authProvider.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| SessionProvider ラップ | NextAuth SessionProvider による子コンポーネントのラップ | プロバイダー設定・コンテキスト提供 |
| 子コンポーネント表示 | 子コンポーネントの正常なレンダリング | コンポーネント表示・階層構造 |

### 5.2 トーストプロバイダー (`providers/toastProvider.test.tsx`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| トースト表示機能 | トーストメッセージの表示・管理 | メッセージ表示・タイプ別スタイル |
| トースト非表示機能 | トーストの自動・手動非表示 | タイマー・クローズ機能 |

---

## 6. ユーティリティテスト

### 6.1 MongoDB接続 (`lib/utils/mongodb.test.ts`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| データベース接続 | MongoDB への接続機能 | 接続確立・接続オブジェクト取得 |
| コレクション操作 | データベースコレクションへのアクセス | collection メソッド・操作可能性 |
| クライアント有効性 | MongoDB クライアントの有効性確認 | クライアントオブジェクト・メソッド確認 |

### 6.2 OpenAI連携 (`lib/utils/openai.test.ts`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 食事分析実行 | OpenAI API を使用した食事分析 | AI分析・結果生成 |
| APIエラー処理 | OpenAI API エラー時の処理 | エラーメッセージ・例外処理 |
| レスポンス未取得処理 | API レスポンスが空の場合の処理 | デフォルトメッセージ・フォールバック |

---

## 7. ミドルウェアテスト

### 7.1 認証ミドルウェア (`middleware.test.ts`)
| テスト項目 | 説明 | 検証内容 |
|-----------|------|----------|
| 認証済みトップページリダイレクト | 認証済みユーザーのトップページアクセス時のリダイレクト | `/home` へのリダイレクト |
| 未認証トップページ表示 | 未認証ユーザーのトップページ表示許可 | ページ表示・リダイレクトなし |
| 認証不要パススキップ | 認証不要パスの処理スキップ | `/login`, `/register` 等のスキップ |
| 保護パス未認証リダイレクト | 保護されたパスへの未認証アクセス時のリダイレクト | `/login` へのリダイレクト |
| 保護パス認証済みアクセス許可 | 認証済みユーザーの保護パスアクセス許可 | アクセス許可・処理継続 |
| API保護パス未認証リダイレクト | 保護されたAPIパスへの未認証アクセス処理 | ログインページリダイレクト |

---

## テスト実行コマンド

```bash
# 全テスト実行
npm test

# 監視モードでテスト実行
npm run test:watch

# カバレッジ付きテスト実行
npm run test:coverage

# 特定のテストファイル実行
npm test -- --testPathPattern=openai.test.ts
```

---

## テスト環境設定

### 必要なモック
- `next/navigation`: Next.js ナビゲーションフック
- `next-auth/react`: NextAuth React フック
- `next-auth/jwt`: NextAuth JWT ユーティリティ
- `framer-motion`: アニメーションライブラリ
- `@heroicons/react`: アイコンコンポーネント
- `mongodb`: MongoDB ドライバー
- `openai`: OpenAI API クライアント

### テストユーティリティ
- `@testing-library/react`: React コンポーネントテスト
- `@testing-library/jest-dom`: DOM マッチャー
- `@testing-library/user-event`: ユーザーインタラクションシミュレーション

---

## テスト品質指標

### カバレッジ目標
- **ライン カバレッジ**: 80% 以上
- **関数 カバレッジ**: 85% 以上
- **ブランチ カバレッジ**: 75% 以上
- **ステートメント カバレッジ**: 80% 以上

### テスト分類別件数
| カテゴリ | ファイル数 | 主要テスト項目数 |
|----------|-----------|-----------------|
| ページコンポーネント | 9 | 25+ |
| API ルート | 12 | 40+ |
| UI コンポーネント | 11 | 35+ |
| カスタムフック | 1 | 7 |
| プロバイダー | 2 | 4 |
| ユーティリティ | 2 | 6 |
| ミドルウェア | 1 | 6 |
| **合計** | **38** | **123+** |

---

## 注意事項

1. **モック設定**: 各テストファイルで適切なモックが設定されていることを確認
2. **非同期処理**: `waitFor` を使用した非同期処理の適切な待機
3. **クリーンアップ**: 各テスト後の適切なモッククリアとクリーンアップ
4. **環境変数**: テスト環境での適切な環境変数設定
5. **ブラウザAPI**: `fetch` 等のブラウザAPIの適切なモック化

---

## 更新履歴

| 日付 | 更新内容 | 更新者 |
|------|----------|--------|
| 2024-01-XX | 初版作成 | AI Assistant |

